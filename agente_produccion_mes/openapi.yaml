openapi: 3.0.3
info:
  title: Agente de Producción MES API
  version: 1.0.0
  description: |
    API para monitoreo de producción en tiempo real, análisis de desviaciones,
    cálculo de OEE y recomendaciones operativas para agentes de IA industriales.

servers:
  - url: hhttps://production-bob.onrender.com

tags:
  - name: Produccion
  - name: Analisis
  - name: Materiales
  - name: Calidad
  - name: Personal

paths:

  /:
    get:
      tags: [Produccion]
      summary: Estado general de la API
      operationId: getApiStatus
      responses:
        "200":
          description: Información general

  /ordenes-produccion/list:
    get:
      tags: [Produccion]
      summary: Lista todas las órdenes de producción
      operationId: listOrdenesProduccion
      responses:
        "200":
          description: Lista de órdenes

  /ordenes-produccion/activas:
    get:
      tags: [Produccion]
      summary: Obtiene órdenes activas
      operationId: getOrdenesActivas
      responses:
        "200":
          description: Órdenes activas

  /produccion-actual:
    get:
      tags: [Produccion]
      summary: Estado actual de líneas de producción
      operationId: getProduccionActual
      responses:
        "200":
          description: Estado por línea

  /analisis-turno:
    post:
      tags: [Analisis]
      summary: Analiza desviaciones y causas raíz por turno
      operationId: analizarTurno
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AnalisisTurnoQuery"
      responses:
        "200":
          description: Resultado del análisis del turno
        "404":
          description: Línea no encontrada

  /consumo-materiales/{orden_id}:
    get:
      tags: [Materiales]
      summary: Consumo de materiales vs BOM
      operationId: getConsumoMateriales
      parameters:
        - name: orden_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Consumo de materiales
        "404":
          description: Orden no encontrada

  /material-faltante:
    post:
      tags: [Materiales]
      summary: Identifica materiales faltantes para una orden
      operationId: getMaterialFaltante
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MaterialFaltanteQuery"
      responses:
        "200":
          description: Materiales faltantes

  /downtime/list:
    get:
      tags: [Analisis]
      summary: Lista eventos de downtime
      operationId: listDowntime
      responses:
        "200":
          description: Lista downtime

  /scrap/list:
    get:
      tags: [Calidad]
      summary: Lista eventos de scrap
      operationId: listScrap
      responses:
        "200":
          description: Lista scrap

  /oee/calcular/{linea}:
    get:
      tags: [Analisis]
      summary: Calcula OEE por línea
      operationId: calcularOEE
      parameters:
        - name: linea
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Resultado OEE
        "404":
          description: Línea no encontrada

  /personal/asignado:
    get:
      tags: [Personal]
      summary: Personal asignado por línea
      operationId: getPersonalAsignado
      responses:
        "200":
          description: Personal asignado

components:
  schemas:

    AnalisisTurnoQuery:
      type: object
      required:
        - linea
        - turno
      properties:
        linea:
          type: string
          example: LINEA_1
        turno:
          type: integer
          example: 1
        fecha:
          type: string
          format: date
          nullable: true
          example: "2026-02-16"

    MaterialFaltanteQuery:
      type: object
      required:
        - orden_id
      properties:
        orden_id:
          type: string
          example: OP-10234

  responses:
    ErrorResponse:
      description: Error general
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
